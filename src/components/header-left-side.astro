---
import Navbar from "../components/navbar.astro";
import ThemeLanguageControls from "./theme-language-controls.astro";
import { getTranslation, getLocaleFromPath } from "../utils/i18n";

const locale = getLocaleFromPath(Astro.url.pathname);
const t = (key: string) => getTranslation(locale, key);
---

<header
  class="flex flex-col justify-between lg:sticky lg:top-0 lg:flex lg:max-h-screen lg:w-1/2 lg:flex-col lg:justify-between lg:py-24"
>
  <div>
    <h1
      class="ml11 text-4xl font-bold tracking-tight text-slate-900 sm:text-5xl dark:text-slate-300"
      aria-label={t("common.name")}
    >
      <span class="text-wrapper" aria-hidden="true">
        <span class="line line1"></span>
        <span class="letters">{t("common.name")}</span>
      </span>
    </h1>
    <h2 class="mt-3 text-lg font-medium tracking-tight text-slate-900 sm:text-xl dark:text-slate-300">
      {t("common.title")}
    </h2>
    <p class="mt-4 max-w-xs leading-normal text-slate-600 dark:text-slate-400">
      {t("header.description")}
    </p>
    <div class="mt-6">
      <ThemeLanguageControls />
    </div>
  </div>
  <Navbar />
</header>

<script>
  import anime from "animejs";

  // Wrap every letter in a span
  var textWrapper = document.querySelector(".ml11 .letters");
  if (textWrapper) {
    textWrapper.innerHTML = (textWrapper.textContent ?? "").replace(
      /([^\x00-\x80]|\w)/g,
      "<span class='letter'>$&</span>"
    );

    anime
      .timeline({
        easing: "easeOutExpo",
        duration: 500,
      })
      .add({
        targets: ".ml11 .line",
        scaleY: [0, 1],
        opacity: [0.5, 1],
        delay: 500,
      })
      .add({
        targets: ".ml11 .line",
        translateX: [0, textWrapper.getBoundingClientRect().width + 10],
        duration: 1000,
      })
      .add(
        {
          targets: ".ml11 .letter",
          opacity: [0, 1],
          duration: 600,
          offset: "-=775",
          delay: (el, i) => 40 * (i + 1),
        },
        "-=900"
      );
  }
  anime({
    targets: ".ml11 .line",
    opacity: [0, 1],
    easing: "linear",
    loop: true,
    duration: 1000,
  });
</script>

<style>
  .ml11 .text-wrapper {
    position: relative;
    display: inline-block;
    padding-top: 0.1em;
    padding-right: 0.05em;
    padding-bottom: 0.15em;
  }

  .ml11 .line {
    opacity: 0;
    position: absolute;
    left: 0;
    height: 100%;
    width: 3px;
    background-color: #0f172a;
    transform-origin: 0 50%;
    transition: background-color 0.3s ease;
  }

  .dark .ml11 .line {
    background-color: #cbd5e1;
  }

  .ml11 .line1 {
    top: 0;
    left: 0;
  }

  .ml11 .letter {
    display: inline-block;
    line-height: 1em;
  }
</style>
